# kind

## Installation notes

https://kind.sigs.k8s.io/docs/user/quick-start/#installation

1. `[ $(uname -m) = x86_64 ] && curl -Lo ./kind https://kind.sigs.k8s.io/dl/v0.30.0/kind-linux-amd64`
    *The use of an expression like in the above command confused me at first. Of course, it's a test! It checks if you are on a x86_64 machine and will return 1 if not, and execution of the second command won't happen.*
2. `chmod +x ./kind`
3. `sudo mv ./kind /usr/local/bin/kind`



1. `kind create cluster` (This will bootstrap a Kubernetes cluster using a pre-built node image.)

    *Set kubectl context to "kind-kind"* <- It seems this means it has set it. It is not encouraging us to do it. Try running the verify command, if that works that's evidence it's already done.

2. Verify: `kubectl cluster-info --context kind-kind`
3. `docker ps`
    ~~~bash
    CONTAINER ID   IMAGE                  COMMAND                  CREATED          STATUS          PORTS                       NAMES
    c5d5bf583e96   kindest/node:v1.34.0   "/usr/local/bin/entr…"   42 seconds ago   Up 40 seconds   127.0.0.1:39153->6443/tcp   kind-control-plane
    ~~~


## Cluster management

`kind create cluster --help`


    After creating a cluster, you can use kubectl to interact with it by using the configuration file generated by kind.

    By default, the cluster access configuration is stored in ${HOME}/.kube/config if $KUBECONFIG environment variable is not set.

    If $KUBECONFIG environment variable is set, then it is used as a list of paths (normal path delimiting rules for your system). These paths are merged. 

    You can use the --kubeconfig flag when creating the cluster, then only that file is loaded. The flag may only be set once and no merging takes place.


You can create more clusters:

`kind create cluster --name kind-2`
`kind get clusters`

    In order to interact with a specific cluster, you only need to specify the cluster name as a context in kubectl:

`kubectl cluster-info --context kind-kind`
`kubectl cluster-info --context kind-kind-2`

`kind delete cluster`

Exporting Cluster Logs:
`kind export logs ./somedir`



### Configure a multi-node cluster

Example yaml:
https://raw.githubusercontent.com/kubernetes-sigs/kind/main/site/content/docs/user/kind-example-config.yaml


`kind create cluster --config kind-example-config.yaml`

This should be enough for a local lab:
~~~yml
# three node (two workers) cluster config
kind: Cluster
apiVersion: kind.x-k8s.io/v1alpha4
nodes:
- role: control-plane
- role: worker
- role: worker
~~~


You can map extra ports from the nodes to the host machine with extraPortMappings:

~~~yml
kind: Cluster
apiVersion: kind.x-k8s.io/v1alpha4
nodes:
- role: control-plane
  extraPortMappings:
  - containerPort: 80
    hostPort: 80
    listenAddress: "0.0.0.0" # Optional, defaults to "0.0.0.0"
    protocol: udp # Optional, defaults to tcp
~~~


You can also set a specific Kubernetes version by setting the node’s container image:
~~~yml
kind: Cluster
apiVersion: kind.x-k8s.io/v1alpha4
nodes:
- role: control-plane
  image: kindest/node:v1.16.4@sha256:b91a2c2317a000f3a783489dfb755064177dbc3a0b2f4147d50f04825d016f55
- role: worker
  image: kindest/node:v1.16.4@sha256:b91a2c2317a000f3a783489dfb755064177dbc3a0b2f4147d50f04825d016f55
~~~
Releases page: `https://github.com/kubernetes-sigs/kind/releases`





### kind ingress and load balancer

* kind.sigs.k8s.io/docs/user/ingress
* https://kind.sigs.k8s.io/docs/user/loadbalancer



